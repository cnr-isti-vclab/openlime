<!doctype html>
<html>
<head>
	<title>OpenLime</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="UTF-8" />

	<link rel="stylesheet" href="skin.css" />
	<style>
		html,
		body {
		  margin: 0px;
		  padding: 0px;
		  height: 100%;
		}
	
		#openlime {
		  height: 80%;
		  position:relative;
		}
	
		#openlime>canvas {
		  width: 100%;
		  height: 100%;
		  overflow: hidden;
		  background-color:black;
		  /* this is important, it would cause firefox flickering! */
		}
	
		.openlime-overlay, .openlime-svgoverlay {
		  position:absolute;
		  top:0px;
		  width:100%;
		  height:100%;
		}
	  </style>
	
</head>
<body>

<div id="openlime">
</div>

<script src="openlime.js"></script>


<script>
let lime = new OpenLIME.OpenLIME('#openlime');

let layer0 = new OpenLIME.Layer({ 
	label: '4',
	layout: 'tarzoom', 
	type:'rti',
	url: 'assets/rti/hsh/info.json',
//	url: 'Data/4/info.json',
	normals: false
});
lime.canvas.addLayer('coin', layer0);
	
let anno = new OpenLIME.AnnotationLayer({ 
	label: 'Annotations',
	viewBox: "0 0 256 256",
	style:` 
		.openlime-annotation { pointer-events:stroke; opacity: 0.7; }
		.openlime-annotation:hover { cursor:pointer; opacity: 1.0; }
			
		:focus { fill:yellow; }
		path { fill:none; stroke-width:2; stroke:#000; vector-effect:non-scaling-stroke; pointer-events:all; }
		path:hover { cursor:pointer; stroke:#f00; }

		rect { fill:rgba(255, 0, 0, 0.2); stroke:rgba(127, 0, 0, 0.7); vector-effect:non-scaling-stroke;}
		circle { fill:rgba(255, 0, 0, 0.2); stroke:#800; stroke-width:1px; vector-effect:non-scaling-stroke; pointer-events:all;  }
		circle.point { stroke-width:10px }
		.selected { stroke:#ff0000; stroke-width:4; }
		`,
	infoTemplate: (annotation) => { return `
		<h3>${annotation.class}</h3>
		<p>${annotation.description}</p>
		`; },
	annotations: 'crud.php',
	editable: true,
}); 

anno.addEvent('createAnnotation', createAnnotation);
anno.addEvent('deleteAnnotation', deleteAnnotation);
anno.addEvent('updateAnnotation', updateAnnotation);

lime.canvas.addLayer('anno', anno);
let ui = new OpenLIME.UIBasic(lime);
ui.editor.multiple = true;

async function updateAnnotation(layer, annotation) {
	annotation.action = 'update';
	const response = await fetch('crud.php', {method: 'POST', body: JSON.stringify(annotation)});
	if (!response.ok) {
		 const message = `An error has occured: ${response.status}`;
		 throw new Error(message);
	}
	let json = await response.json();
	console.log(json);
}

async function createAnnotation(layer, annotation) {
	annotation.action = 'create';
	const response = await fetch('crud.php', {method: 'POST', body: JSON.stringify(annotation)});
	if (!response.ok) {
		 const message = `An error has occured: ${response.status}`;
		 throw new Error(message);
	}
	let json = await response.json();
	console.log(json);
}

async function deleteAnnotation(layer, annotation) {
	annotation.action = 'delete';
	const response = await fetch('crud.php', {method: 'POST', body: JSON.stringify(annotation)});
	if (!response.ok) {
		 const message = `An error has occured: ${response.status}`;
		 throw new Error(message);
	}
	let json = await response.json();
	console.log(json);
}

</script>
<input type="text"/>
</body>
</html>
