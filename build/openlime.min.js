!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).OpenLIME={})}(this,(function(e){"use strict";class t{constructor(e,t,s,i,r){if(null!==e)this.x=e||0,this.y=t||0,this.z=s||1,this.a=i||0,this.t=r||0;else{let e={x:0,y:0,z:1,a:0,t:0};Object.assing(this,e())}}copy(){return Object.assign({},this)}interpolate(e,t,s){if(s<e.t)return e;if(s>t.t)return t;let i=t.t-e.t;if(i<1e-4)return t;let r=(s-e.t)/i,a=(t.t-i)/i;for(let s of["x","y","z","a"])this[s]=a*e[s]+r*t[s];this.t=s}}class s{constructor(e){Object.assign(this,{bounded:!0,maxZoom:4,minZoom:"full"}),Object.assign(this,e),this.target=new t(this.target),this.source=this.target.copy(),console.log(this.target,this.source)}getCurrentTransform(e){if(e<this.target.source)return this.source;if(e>this.target.t)return this.target;let s=new t;return s.interpolate(this.source,this.target,e),s}}class r{constructor(e,t,r){Object.assign(this,{preserveDrawingBuffer:!1,viewport:[0,0,0,0],gl:null,layers:{}});if(r){Object.assign(this,r);for(let e in this.layers)this.layers[i]=new Layer(e,this.layers[i])}this.camera=new s(this.camera),this.initElement(e)}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.prefetch(),this.redraw()}initElement(e){if(!e)throw"Missing element parameter";if("string"==typeof e&&!(e=document.querySelector(e)))throw"Could not find dom element.";if(!e.tagName)throw"Element is not a DOM element";if("CANVAS"!=e.tagName)throw"Element is not a canvas element";let t={antialias:!1,depth:!1,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=this.gl||e.getContext("webgl2",t)||e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!this.gl)throw"Could not create a WebGL context";this.canvas=e}setPosition(e,t,s,i,r){}draw(e){let t=this.camera.getCurrentTransform(e);this.prefetch(t);let s=Object.values(this.layers).sort(((e,t)=>e.zindex-t.zindex));for(let e of s)s.visible&&s.draw(t);return t.t==this.camera.target.t}prefetch(e){for(let t in this.layers)this.layers[t].prefetch(e,this.viewport)}}e.OpenLIME=class{constructor(e,t){if("string"==typeof e&&(e=document.querySelector(e)),!e)throw"Missing element parameter";this.containerElement=e,this.canvasElement=e.querySelector("canvas"),this.canvasElement||(this.canvasElement=document.createElement("canvas"),e.appendChild(this.canvasElement)),this.canvasElement.addEventListener("resize",(e=>this.resize())),Object.assign(this,{background:[0,0,0,1]}),this.canvas=new r(this.canvasElement,this.canvas)}resize(e){console.log(e),redraw()}redraw(){this.animaterequest||(this.animaterequest=requestAnimationFrame((e=>{this.draw(e)})))}draw(e){console.log("drawing"),e||(e=performance.now()),this.animaterequest=null;let t=this.canvas.gl;t.viewport(0,0,this.canvas.width,this.canvas.height);var s=this.background;t.clearColor(s[0],s[1],s[2],s[3],s[4]),t.clear(t.COLOR_BUFFER_BIT),this.canvas.draw(e)||this.redraw()}},Object.defineProperty(e,"__esModule",{value:!0})}));
