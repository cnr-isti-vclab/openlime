!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).OpenLIME={})}(this,(function(t){"use strict";class e{constructor(t,e,i,s,r){Object.assign(this,{x:0,y:0,z:1,a:0,t:0}),r||(r=performance.now()),"object"==typeof t?Object.assign(this,t):void 0!==t&&Object.assign(this,{x:t,y:e,z:i,a:s,t:r})}copy(){let t=new e;return Object.assign(t,this),t}apply(t,e){return{x:t*this.z+this.x,y:e*this.z+this.y}}interpolate(t,e,i){if(i<t.t)return t;if(i>e.t)return e;let s=e.t-t.t;if(s<1e-4)return void Object.assign(this,e);let r=(i-t.t)/s,a=(e.t-i)/s;for(let i of["x","y","z","a"])this[i]=a*t[i]+r*e[i];this.t=i}rotate(t,e,i){i=Math.PI*(i/180);return{x:t=Math.cos(i)*t+Math.sin(i)*e,y:e=-Math.sin(i)*t+Math.cos(i)*e}}compose(t){let e=this.copy(),i=t;e.z*=i.z,e.a+=i.a;var s=this.rotate(e.x,e.y,i.a);return e.x=s.x*i.z+i.x,e.y=s.y*i.z+i.y,e}projectionMatrix(t){let e=this.z,i=2*e/(t[2]-t[0]),s=2*e/(t[3]-t[1]);return[i,0,0,0,0,s,0,0,0,0,1,0,this.x*i,-this.y*s,0,1]}toMatrix(){let t=this.z;return[t,0,0,0,0,t,0,0,0,0,1,0,t*x,t*y,0,1]}}class i{constructor(t){Object.assign(this,{viewport:[0,0,1,1],bounded:!0,maxZoom:4,minZoom:"full",signals:{update:[]}}),Object.assign(this,t),this.target=new e(this.target),this.source=this.target.copy()}copy(){let t=new i;return Object.assign(t,this),t}addEvent(t,e){this.signals[t].push(e)}emit(t){for(let e of this.signals[t])e(this)}setViewport(t){this.viewport=t}mapToScene(t,e,i){return t-=(this.viewport[2]+this.viewport[0])/2,e-=(this.viewport[3]+this.viewport[1])/2,t/=i.z,e/=i.z,{x:t-=i.x,y:e-=i.y}}setPosition(t,e,i,s,r){let a=performance.now();this.source=this.getCurrentTransform(a),Object.assign(this.target,{x:e,y:i,z:s,a:r,t:a+t}),this.emit("update")}pan(t,e,i){let s=performance.now(),r=this.getCurrentTransform(s);r.dx+=e,r.dy+=i}zoom(t,e,i,s){i||(i=0),s||(s=0);let r=performance.now(),a=this.getCurrentTransform(r);console.log("diff:",a.x,i,e,a.z),a.x+=(a.x+i)*(1-e),a.y+=(a.y+s)*(1-e),this.setPosition(t,a.x,a.y,a.z*e,a.a)}getCurrentTransform(t){if(t<this.source.t)return this.source.copy();if(t>=this.target.t)return this.target.copy();let i=new e;return i.interpolate(this.source,this.target,t),i}fit(t,e,i){e||(e=0);let s=this.viewport[2]-this.viewport[0],r=this.viewport[3]-this.viewport[1],a=t[2]-t[0],o=t[3]-t[1],h=Math.min(s/a,r/o);this.setPosition(e,(t[0]+t[2])/2,(t[1]+t[3])/2,h,0)}}class s{constructor(t,e,i){if(Object.assign(this,{preserveDrawingBuffer:!1,gl:t,camera:e,layers:{},signals:{update:[]}}),i){Object.assign(this,i);for(let t in this.layers)this.addLayer(t,new Layer(t,this.layers[t]))}}addEvent(t,e){this.signals[t].push(e)}emit(t){for(let e of this.signals[t])e(this)}addLayer(t,e){e.addEvent("update",(()=>{console.log("update!"),this.emit("update")})),e.gl=this.gl,this.layers[t]=e}draw(t){let e=this.gl,i=this.camera.viewport;e.viewport(i[0],i[1],i[2],i[3]);var s=[0,1,0,1];e.clearColor(s[0],s[1],s[2],s[3],s[4]),e.clear(e.COLOR_BUFFER_BIT);let r=this.camera.getCurrentTransform(t);this.prefetch(r);let a=Object.values(this.layers).sort(((t,e)=>t.zindex-e.zindex));for(let t of a)t.visible&&t.draw(r,i);return r.t==this.camera.target.t}prefetch(t){for(let e in this.layers)this.layers[e].prefetch(t,this.camera.viewport)}}class r{constructor(t){Object.assign(this,{type:"vec3",colorSpace:"linear",attribute:"kd"}),Object.assign(this,t)}loadImage(t,e,i){(async()=>{var s=await fetch(t);if(!s.ok)return console.log(),void i("Failed loading "+t+": "+s.statusText);let r=await s.blob();if("undefined"!=typeof createImageBitmap){"undefined"!=typeof InstallTrigger?createImageBitmap(r).then((t=>this.loadTexture(t,i))):createImageBitmap(r,{imageOrientation:"flipY"}).then((t=>this.loadTexture(e,t,i)))}else{var a=window.URL||window.webkitURL,o=document.createElement("img");o.onerror=function(t){console.log("Texture loading error!")},o.src=a.createObjectURL(r),o.onload=function(){a.revokeObjectURL(o.src),this.loadTexture(e,o,i)}}})().catch((t=>{i(null)}))}loadTexture(t,e,i){this.width=e.width,this.height=e.height;var s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,e),i(s)}}class a{constructor(t){Object.assign(this,{version:100,samplers:[],uniforms:{},name:"",body:"",program:null,needsUpdate:!0}),Object.assign(this,t)}createProgram(t){let e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,this.vertShaderSrc(100)),t.compileShader(e);let i=t.getShaderParameter(e,t.COMPILE_STATUS);if(!i)throw console.log(t.getShaderInfoLog(e)),Error("Failed vertex shader compilation: see console log and ask for support.");let s=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(s,this.fragShaderSrc()),t.compileShader(s),this.program&&t.deleteProgram(this.program);let r=t.createProgram();if(t.getShaderParameter(s,t.COMPILE_STATUS),i=t.getShaderParameter(s,t.COMPILE_STATUS),!i)throw console.log(this.fragShaderSrc()),console.log(t.getShaderInfoLog(s)),Error("Failed fragment shader compilation: see console log and ask for support.");if(t.attachShader(r,e),t.attachShader(r,s),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS)){var a=t.getProgramInfoLog(r);throw new Error("Could not compile WebGL program. \n\n"+a)}this.coordattrib=t.getAttribLocation(r,"a_position"),t.vertexAttribPointer(this.coordattrib,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.coordattrib),this.texattrib=t.getAttribLocation(r,"a_texcoord"),t.vertexAttribPointer(this.texattrib,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.texattrib),this.matrixlocation=t.getUniformLocation(r,"u_matrix"),this.program=r,this.needsUpdate=!1}vertShaderSrc(){return"#version 300 es\n\nprecision highp float; \nprecision highp int; \n\nuniform mat4 u_matrix;\nin vec4 a_position;\nin vec2 a_texcoord;\n\nout vec2 v_texcoord;\n\nvoid main() {\n\tgl_Position = u_matrix * a_position;\n\tv_texcoord = a_texcoord;\n}"}fragShaderSrc(){return this.body}}class o{constructor(t,e){if(Object.assign(this,{type:e,width:1,height:1,tilesize:256,overlap:0,nlevels:1,ntiles:1,suffix:"jpg",qbox:[],bbox:[],signals:{ready:[]},status:null}),"string"!=typeof t)"object"==typeof t&&Object.assign(this,t);else{this.url=t;let e=()=>{this.ntiles=this.initBoxes(),this.status="ready",this.emit("ready")};switch(this.type){case"image":this.initImage(e);break;case"google":this.initGoogle(e);break;case"deepzoom":this.initDeepzoom(e)}}}addEvent(t,e){this.signals[t].push(e)}emit(t){for(let e of this.signals[t])e(this)}boundingBox(){return[-width/2,-height/2,width/2,height/2]}index(t,e,i){for(var s=0,r=this.nlevels-1;r>t;r--)s+=this.qbox[r][2]*this.qbox[r][3];return s+i*this.qbox[t][2]+e}initBoxes(){this.qbox=[],this.bbox=[];var t=this.width,e=this.height;if("image"==this.type)return this.qbox[0]=[0,0,1,1],this.bbox[0]=[0,0,t,e],1;for(var i=0,s=this.nlevels-1;s>=0;s--){var r=this.nlevels-1-s;this.qbox[r]=[0,0,0,0],this.bbox[r]=[0,0,t,e];for(var a=0;a*this.tilesize<e;a++){this.qbox[r][3]=a+1;for(var o=0;o*this.tilesize<t;o++)i++,this.qbox[r][2]=o+1}t>>>=1,e>>>=1}return i}tileCoords(t,e,i){let s=this.width,r=this.height;var a=new Float32Array([0,0,0,1,1,1,1,0]);if("image"==this.type)return{coords:new Float32Array([-s/2,-r/2,0,-s/2,r/2,0,s/2,r/2,0,s/2,-r/2,0]),tcoords:a};let o=new Float32Array([0,0,0,0,1,0,1,1,0,1,0,0]),h=this.tilesize*(1<<t),n=h,l=h;"google"!=this.layout&&(h*(e+1)>this.width&&(n=this.width-h*e),h*(i+1)>this.height&&(l=this.height-h*i));var u=this.qbox[t][2]-1,d=this.qbox[t][3]-1,c=this.overlap;if(c){let s=c/(n/(1<<t)+(0==e?0:c)+(e==u?0:c)),r=c/(l/(1<<t)+(0==i?0:c)+(i==d?0:c));a[0]=a[2]=0==e?0:s,a[1]=a[7]=0==i?0:r,a[4]=a[6]=e==u?1:1-s,a[3]=a[5]=i==d?1:1-r}for(let t=0;t<o.length;t+=3)o[t]=o[t]*n+size*e-this.width/2,o[t+1]=o[t+1]*l+size*i+this.height/2;return{coords:o,tcoords:a}}neededBox(t,e,i){if("image"==this.layout)return{level:0,box:[[0,0,1,1]]};for(var s=Math.max(0,Math.min(Math.floor(Math.log2(e.z)+this.mipmapbias),this.nlevels-1)),r=[],a=this.nlevels-1;a>=s;a--){var o=this.getIBox(t,e),h=this.tilesize*Math.pow(2,a),n=[Math.floor(o[0]/h),Math.floor(o[1]/h),Math.floor((o[2]-1)/h)+1,Math.floor((o[3]-1)/h)+1];n[0]=Math.max(n[0]-i,this.qbox[a][0]),n[1]=Math.max(n[1]-i,this.qbox[a][1]),n[2]=Math.min(n[2]+i,this.qbox[a][2]),n[3]=Math.min(n[3]+i,this.qbox[a][3]),r[a]=n}return{level:s,pyramid:r}}getTileURL(t,e,i,s){throw Error("Layout not defined or ready.")}initImage(){}initImage(t){this.nlevels=1,this.tilesize=0,this.getTileURL=(t,e,i,s)=>t,t()}initGoogle(t){if(!this.width||!this.height)throw"Google rasters require to specify width and height";this.tilesize=256,this.overlap=0;let e=Math.max(this.width,this.height)/this.tilesize;this.nlevels=Math.ceil(Math.log(e)/Math.LN2)+1,this.getTileURL=(t,e,i,s)=>t+"/"+parseInt(this.nlevels-1-s)+"/"+i+"/"+e+"."+this.suffix,t()}initDeepzoom(t){(async()=>{var e=await fetch(this.url);if(!e.ok)return void(this.status="Failed loading "+this.url+": "+e.statusText);let i=await e.text(),s=(new window.DOMParser).parseFromString(i,"text/xml").documentElement;this.suffix=s.getAttribute("Format"),this.tilesize=s.getAttribute("TileSize"),this.overlap=s.getAttribute("Overlap");let r=s.querySelector("Size");this.width=r.getAttribute("Width"),this.height=r.getAttribute("Height");let a=Math.max(this.width,this.height)/this.tilesize;this.nlevels=Math.ceil(Math.log(a)/Math.LN2)+1,this.url=this.url.substr(0,this.url.lastIndexOf("."))+"_files/",this.getTileURL=(t,e,i,s)=>(t=t.substr(0,t.lastIndexOf("."))+"_files/")+parseInt(this.nlevels-1-s)+"/"+e+"_"+i+"."+this.suffix,t()})().catch((t=>{console.log(t),this.status=t}))}initZoomify(){this.overlap=0,(async()=>{var t=await fetch(this.url);if(!t.ok)return void(this.status="Failed loading "+this.url+": "+t.statusText);await t.text();let e=t.split('"');this.tilesize=parseInt(e[11]);let i=Math.max(this.width,this.height)/this.tilesize;this.nlevels=Math.ceil(Math.log(i)/Math.LN2)+1,this.url=this.url.substr(0,this.url.lastIndexOf("/")),this.getTileURL=(t,e,i,s)=>{let r=parseInt(this.nlevels-1-s),a=this.index(s,e,i)>>>0>>8;return t=t.substr(0,t.lastIndexOf("/")),this.url+"/TileGroup"+a+"/"+r+"-"+e+"-"+i+"."+this.suffix},callback()})().catch((t=>{console.log(t),this.status=t}))}}class h{constructor(t){if(Object.assign(this,{transform:new e,visible:!0,zindex:0,opacity:1,rasters:[],controls:{},shaders:{},layout:"image",shader:null,gl:null,prefetchBorder:1,mipmapBias:.5,maxRequest:4,signals:{update:[]},tiles:[],queued:[],requested:{}}),Object.assign(this,t),this.type){if(this.type in this.types)return t.type=null,this.types[this.type](t);throw"Layer type: "+this.type+" has not been loaded"}this.rasters=this.rasters.map((t=>new r(t))),this.transform=new e(this.transform),"object"!=typeof this.layout&&this.rasters.length&&this.setLayout(new o(this.rasters[0],this.layout)),this.shader&&(this.shader=new a(this.shader))}addEvent(t,e){this.signals[t].push(e)}emit(t){for(let e of this.signals[t])e(this)}setLayout(t){let e=()=>{this.status="ready",this.setupTiles(),this.emit("update")};"ready"==t.status?e():t.addEvent("ready",e),this.layout=t}setVisible(t){this.visible=t,this.emit("update")}setZindex(t){this.zindex=t,this.emit("update")}boundingBox(){return layuout.boundingBox()}draw(t,e){if("ready"!=this.status)return;if(!this.shader)throw"Shader not specified!";if(!this.tiles||!this.tiles[0])return;this.prepareWebGL(),0 in this.requested||0==this.tiles[0].missing||this.loadTile({index:0,level:0,x:0,y:0});let i=(t=t.compose(this.transform)).projectionMatrix(e);this.gl.uniformMatrix4fv(this.shader.matrixlocation,this.gl.FALSE,i),0==this.tiles[0].missing&&this.drawTile(0,0,0)}drawTile(t,e,i){var s=this.layout.index(t,e,i);let r=this.tiles[s];if(0!=r.missing)throw"Attempt to draw tile still missing textures";let a=this.layout.tileCoords(t,e,i);this.updateTileBuffers(a.coords,a.tcoords);let o=this.gl;for(var h=0;h<this.shader.samplers.length;h++){let t=this.shader.samplers[h].id;o.activeTexture(o.TEXTURE0+h),o.bindTexture(o.TEXTURE_2D,r.tex[t])}o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}updateTileBuffers(t,e){let i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,this.vbuffer),i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW),i.vertexAttribPointer(this.shader.coordattrib,3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.shader.coordattrib),i.bindBuffer(i.ARRAY_BUFFER,this.tbuffer),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW),i.vertexAttribPointer(this.shader.texattrib,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.shader.texattrib)}setShader(t){if(!t in this.shaders)throw"Unknown shader: "+t;this.shader=this.shaders[t],this.setupTiles()}setupTiles(){if(!this.shader||!this.layout||"ready"!=this.layout.status)return;let t=this.layout.ntiles;if("array"==typeof this.tiles&&this.tiles.length==t)for(let t of this.ntiles){t.missing=this.shader.samplers.length;for(let e of this.shader.samplers)t.tex[e.id]&&t.missing--}else{this.tiles=new Array(t);for(let e=0;e<t;e++)this.tiles[e]={tex:new Array(this.shader.samplers.length),missing:this.shader.samplers.length}}}prepareWebGL(){let t=this.gl;this.shader.needsUpdate&&this.shader.createProgram(t),t.useProgram(this.shader.program),this.ibuffer||(this.ibuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ibuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([3,2,1,3,1,0]),t.STATIC_DRAW),this.vbuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,0,1,0,1,1,0,1,0,0]),t.STATIC_DRAW),this.tbuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.tbuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,0]),t.STATIC_DRAW))}prefetch(t,e){if("ready"!=this.status||!this.visible)return;let i=this.layout.neededBox(t,this.prefetchBorder),s=i.level;this.queued=[];for(let t=this.layout.nlevels-1;t>=s;t--){let e=i.box[t],s=[];for(let i=e[1];i<e[3];i++)for(let r=e[0];r<e[2];r++){let e=this.layout.index(t,r,i);0==this.tiles[e].missing||this.requested[e]||s.push({level:t,x:r,y:i,index:e})}let r=(e[0]+e[2]-1)/2,a=(e[1]+e[3]-1)/2;s.sort((function(t,e){return Math.abs(t.x-r)+Math.abs(t.y-a)-Math.abs(e.x-r)-Math.abs(e.y-a)})),this.queued=this.queued.concat(s)}this.preload()}preload(){for(;Object.keys(this.requested).length<this.maxRequested&&this.queued.length>0;){var t=this.queued.shift();this.loadTile(t)}}loadTile(t){if(this.requested[t.index])throw"AAARRGGHHH double request!";this.requested[t.index]=!0;for(let e of this.shader.samplers){let i=this.layout.getTileURL(this.rasters[e.id].url,t.level,t.x,t.y),s=this.rasters[e.id];s.loadImage(i,this.gl,(i=>{"image"==this.layout.type&&(this.layout.width=s.width,this.layout.height=s.height);let r=this.tiles[t.index];r.tex[e.id]=i,r.missing--,r.missing<=0&&this.emit("update")}))}}}h.prototype.types={};class n extends class{constructor(t,e){Object.assign(this,{element:t,debug:!0,delay:0}),Object.assign(this,e),this.initEvents()}mouseDown(t,e,i){this.debug&&console.log("Down ",t,e)}mouseUp(t,e,i){this.debug&&console.log("Up ",t,e)}mouseMove(t,e,i){this.debug&&console.log("Move ",t,e)}wheelDelta(t,e,i,s){this.debug&&console.log("Delta ",t,e,i)}pinchStart(t,e,i){this.debug&&console.log("ZStart ",t,e)}pinchMove(t,e,i){this.debug&&console.log("ZMove ",t,e)}eventToPosition(t,e){let i=t.currentTarget.getBoundingClientRect(),s=t.clientX,r=t.clientY;return void 0!==e&&(s=t.targetTouches[e].clientX,r=t.targetTouches[e].clientY),{x:s-i.left,y:r-i.top}}initEvents(){let t=this.element;t.addEventListener("contextmenu",(t=>(t.preventDefault(),!1))),t.addEventListener("mouseup",(t=>{let e=this.eventToPosition(t);return this.mouseUp(e.x,e.y,t),t.preventDefault(),!1})),t.addEventListener("mousedown",(t=>{let e=this.eventToPosition(t);return this.mouseDown(e.x,e.y,t),t.preventDefault(),!1}),{capture:!0}),t.addEventListener("mousemove",(t=>{let e=this.eventToPosition(t);return this.mouseMove(e.x,e.y,t),t.preventDefault(),!1})),t.addEventListener("touchstart",(t=>{t.preventDefault();let e=this.eventToPosition(t,0);if(1==t.targetTouches.length)this.mouseDown(e.x,e.y,t);else if(2==t.targetTouches.length){let i=this.eventToPosition(t,1);this.pinchStart(e,i,t)}}),!1),t.addEventListener("touchend",(t=>{let e=this.eventToPosition(t);this.mouseUp(e.x,e.y,t),t.preventDefault()}),!1),t.addEventListener("touchmove",(t=>{let e=this.eventToPosition(t,0);if(1==t.targetTouches.length)this.mouseMove(e.x,e.y,t);else if(2==t.targetTouches.length){let i=this.eventToPosition(t,1);this.pinchMove(e,i,t)}t.preventDefault()}),!1),t.addEventListener("wheel",(t=>{let e=this.eventToPosition(t),i=t.deltaY>0?1:-1;this.wheelDelta(e.x,e.y,i,t),t.preventDefault()}))}}{constructor(t,e,i){super(t,i),this.camera=e,this.zoomAmount=1.2,this.panning=!1,this.startPosition=null,this.startMouse=null}mouseDown(t,e,i){if(!(1&i.buttons))return;this.panning=!0,this.startMouse={x:t,y:e};let s=performance.now();this.startPosition=this.camera.getCurrentTransform(s),this.camera.target=this.startPosition.copy()}mouseUp(t,e,i){this.panning=!1}mouseMove(t,e,i){if(!this.panning)return;let s=t-this.startMouse.x,r=e-this.startMouse.y,a=this.startPosition.z,o=this.startPosition.x+s/a,h=this.startPosition.y+r/a,n=this.startPosition.a;this.camera.setPosition(this.delay,o,h,a,n)}wheelDelta(t,e,i,s){console.log(t,e);let r=this.camera.mapToScene(t,e,this.camera.getCurrentTransform(performance.now())),a=Math.pow(this.zoomAmount,i);this.camera.zoom(this.delay,a,r.x,r.y)}pinchStart(t,e,i){this.debug&&console.log("ZStart ",t,e)}pinchMove(t,e,i){this.debug&&console.log("ZMove ",t,e)}}t.Camera=i,t.Canvas=s,t.Layer=h,t.Layout=o,t.OpenLIME=class{constructor(t,e){if(Object.assign(this,{background:[0,0,0,1],canvas:{},camera:new i}),"string"==typeof t&&(t=document.querySelector(t)),!t)throw"Missing element parameter";this.containerElement=t,this.canvasElement=t.querySelector("canvas"),this.canvasElement||(this.canvasElement=document.createElement("canvas"),t.appendChild(this.canvasElement)),this.initCanvasElement(this.canvasElement),this.canvas=new s(this.gl,this.camera,this.canvas),this.canvas.addEvent("update",(()=>{this.redraw()})),this.camera.addEvent("update",(()=>{this.redraw()})),this.controller=new n(this.containerElement,this.camera),new ResizeObserver((t=>{for(let e of t)this.resize(e.contentRect.width,e.contentRect.height)})).observe(this.canvasElement)}initCanvasElement(t){if(!t)throw"Missing element parameter";if("string"==typeof t&&!(t=document.querySelector(t)))throw"Could not find dom element.";if(!t.tagName)throw"Element is not a DOM element";if("CANVAS"!=t.tagName)throw"Element is not a canvas element";let e={antialias:!1,depth:!1,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=this.gl||t.getContext("webgl2",e)||t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!this.gl)throw"Could not create a WebGL context"}resize(t,e){this.canvasElement.width=t,this.canvasElement.height=e,this.camera.setViewport([0,0,t,e]),this.canvas.prefetch(),this.redraw()}redraw(){this.animaterequest||(this.animaterequest=requestAnimationFrame((t=>{this.draw(t)})))}draw(t){t||(t=performance.now()),this.animaterequest=null,this.canvas.draw(t)||this.redraw()}fit(t,e,i){this.camera.fit(t,e,i),this.redraw()}},t.Raster=r,t.Shader=a,t.Transform=e,Object.defineProperty(t,"__esModule",{value:!0})}));
